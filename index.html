<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kontrol Paneli</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --bg: #0b0f15; --card: #161b22; --blue: #58a6ff; --green: #238636; --red: #da3633; --text: #c9d1d9; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 80px; background: #010409; display: flex; flex-direction: column; align-items: center; padding-top: 20px; border-right: 1px solid #30363d; }
        .nav-link { font-size: 1.5rem; color: #8b949e; margin-bottom: 25px; cursor: pointer; transition: 0.2s; }
        .nav-link:hover, .nav-link.active { color: var(--blue); }
        .container { flex: 1; padding: 25px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .card { background: var(--card); padding: 15px; border-radius: 8px; border: 1px solid #30363d; }
        .card small { color: #8b949e; display: block; margin-bottom: 5px; font-size: 0.75rem; }
        .card span { font-size: 1.2rem; font-weight: bold; }
        .console { background: #000; height: 400px; border-radius: 8px; border: 1px solid #30363d; display: flex; flex-direction: column; }
        .logs { flex: 1; padding: 15px; overflow-y: auto; font-family: monospace; font-size: 13px; color: #d1d5db; line-height: 1.5; }
        .input { border-top: 1px solid #30363d; display: flex; }
        .input input { flex: 1; background: transparent; border: none; color: #fff; padding: 12px; outline: none; }
        .btn { padding: 8px 20px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: #fff; }
        .btn-start { background: var(--green); }
        .btn-stop { background: var(--red); }
        .btn-renew { background: var(--blue); width: 100%; margin-top: 10px; }
        .page { display: none; } .active-page { display: block; }
        .file-item { padding: 10px; border-bottom: 1px solid #30363d; cursor: pointer; display: flex; gap: 10px; }
        .file-item:hover { background: #21262d; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="nav-link active" onclick="show('dash', this)"><i class="fas fa-terminal"></i></div>
        <div class="nav-link" onclick="show('files', this)"><i class="fas fa-folder"></i></div>
    </div>
    <div class="container">
        <div class="header">
            <h2 id="display-ip">Yükleniyor...</h2>
            <div>
                <button class="btn btn-start" onclick="fetch('/api/start', {method:'POST'})">BAŞLAT</button>
            </div>
        </div>
        <div class="stats">
            <div class="card"><small>DURUM</small><span id="status">Çevrimdışı</span></div>
            <div class="card"><small>CPU</small><span>%0.00</span></div>
            <div class="card"><small>RAM</small><span>0MB / 2GB</span></div>
            <div class="card" style="border-color: var(--blue);">
                <small>KALAN SÜRE</small><span id="time">--:--:--</span>
                <button class="btn btn-renew" onclick="fetch('/api/renew', {method:'POST'})">SÜRE EKLE</button>
            </div>
        </div>
        <div id="dash" class="page active-page">
            <div class="console">
                <div class="logs" id="logs"></div>
                <div class="input"><input type="text" id="cmd" placeholder="Komut gönder..." onkeydown="if(event.key==='Enter') sendCmd()"></div>
            </div>
        </div>
        <div id="files" class="page">
            <div id="file-list" class="card"></div>
        </div>
    </div>
    <script>
        const socket = io();
        const ip = localStorage.getItem('ip') || prompt("IP Girin:");
        if(ip) { localStorage.setItem('ip', ip); document.getElementById('display-ip').innerText = ip; }

        socket.on('console', m => {
            const l = document.getElementById('logs');
            l.innerHTML += `<div>${m}</div>`;
            l.scrollTop = l.scrollHeight;
        });

        socket.on('status', s => { document.getElementById('status').innerText = s === 'online' ? 'Çevrimiçi' : 'Çevrimdışı'; });

        socket.on('time', s => {
            const h = Math.floor(s / 3600);
            const m = Math.floor((s % 3600) / 60);
            const sec = s % 60;
            document.getElementById('time').innerText = h + ":" + m + ":" + sec;
        });

        function sendCmd() {
            const i = document.getElementById('cmd');
            fetch('/api/cmd', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({cmd:i.value}) });
            i.value = '';
        }

        function show(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(id === 'files') loadFiles('');
        }

        async function loadFiles(p) {
            const r = await fetch('/api/files?path='+p);
            const data = await r.json();
            const list = document.getElementById('file-list');
            list.innerHTML = "";
            data.forEach(f => {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `<i class="fas ${f.isDir ? 'fa-folder' : 'fa-file'}"></i> ${f.name}`;
                if(f.isDir) div.onclick = () => loadFiles(p ? p+'/'+f.name : f.name);
                list.appendChild(div);
            });
        }
    </script>
</body>
</html>
